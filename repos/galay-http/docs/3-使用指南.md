# 3-使用指南

## 1. 环境与依赖

- CMake 3.22+
- C++23 编译器（GCC 11+ / Clang 14+ / AppleClang 15+）
- `spdlog`
- `galay-kernel`
- `galay-utils`
- 可选：`galay-ssl` + OpenSSL（启用 TLS 时）

统一联调推荐拉取：

```bash
git clone https://github.com/gzj-creator/galay-kernel.git
git clone https://github.com/gzj-creator/galay-utils.git
git clone https://github.com/gzj-creator/galay-http.git
# 可选：启用 TLS 时一并拉取
git clone https://github.com/gzj-creator/galay-ssl.git
```

## 2. 构建

```bash
mkdir -p build
cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
cmake --build . --parallel
```

启用 SSL：

```bash
cmake .. -DCMAKE_BUILD_TYPE=Release -DGALAY_HTTP_ENABLE_SSL=ON
cmake --build . --parallel
```

## 3. 快速上手

### HTTP Echo

```bash
./build/example/E1-EchoServer 8080
./build/example/E2-EchoClient http://127.0.0.1:8080/echo "hello"
```

### WebSocket Echo

```bash
./build/example/E3-WebsocketServer
./build/example/E4-WebsocketClient ws://127.0.0.1:8080/ws
```

### H2c Echo

```bash
./build/example/E9-H2cEchoServer 9080
./build/example/E10-H2cEchoClient 127.0.0.1 9080
```

### 静态文件服务

```bash
./build/example/E11-StaticServer 8090 ./html
```

### HTTP 代理

```bash
./build/example/E1-EchoServer 8080
./build/example/E12-HttpProxy 8081 127.0.0.1 8080
curl -X POST http://127.0.0.1:8081/echo -d "via proxy"
```

## 4. 测试与压测

测试与压测仍沿用现有 `test/` 与 `benchmark/` 体系。

常见执行：

```bash
./build/test/T1-HttpParser
./build/benchmark/B1-HttpServer
```

## 5. 模块（可选）

模块文件：

- `galay-http/module/galay.http.cppm`
- `galay-http/module/galay.http2.cppm`
- `galay-http/module/galay.websocket.cppm`

构建模块目标（工具链支持时）：

```bash
cmake -S . -B build-mod -G Ninja -DBUILD_MODULE_EXAMPLES=ON
cmake --build build-mod --target galay-http-modules --parallel
```

若工具链不支持，CMake 会自动关闭该目标。
