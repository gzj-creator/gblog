# 02-æ€§èƒ½æµ‹è¯•

æœ¬æ–‡æ¡£ä¸ºæ€§èƒ½å‹æµ‹æ•°æ®æ±‡æ€»ï¼Œè¯¦ç»†æ•°æ®è¯·å‚è€ƒå„æ¨¡å—æ–‡æ¡£ã€‚

## æµ‹è¯•å¹³å°

| å¹³å° | æ“ä½œç³»ç»Ÿ | æ¶æ„ | CPU | å†…å­˜ | IO æ¨¡å‹ |
|------|---------|------|-----|------|---------|
| macOS | Darwin 24.6.0 | ARM64 | Apple M4, 10æ ¸ | 24GB | kqueue |
| Linux | Linux 6.8.0-90-generic | x86_64 | Intel i7-14700K, 8æ ¸ | 8GB | epoll / io_uring |

---

## æ€§èƒ½æ€»è§ˆ

### ç½‘ç»œ IO (TCP)

| å¹³å° | IO æ¨¡å‹ | QPS | ååé‡ | è¯„çº§ |
|------|---------|-----|--------|------|
| macOS | **kqueue** | **313,841** | **153.24 MB/s** | â­â­â­â­â­ å“è¶Š |
| Linux | io_uring | 230,066 | 112.34 MB/s | â­â­â­â­â­ ä¼˜ç§€ |
| Linux | epoll | 190,775 | 93.15 MB/s | â­â­â­â­â­ ä¼˜ç§€ |

è¯¦ç»†æ•°æ®: [07-ç½‘ç»œIO.md](07-ç½‘ç»œIO.md#æ€§èƒ½å‹æµ‹æ•°æ®)

### ç½‘ç»œ IO (UDP)

| å¹³å° | IO æ¨¡å‹ | QPS | ååé‡ | ä¸¢åŒ…ç‡ |
|------|---------|-----|--------|--------|
| macOS | kqueue | 35,008 | 8.55 MB/s | 0.00% |
| Linux | io_uring | 35,082 | 8.56 MB/s | 0.00% |
| Linux | epoll | 35,082 | 8.56 MB/s | 0.00% |

è¯¦ç»†æ•°æ®: [04-UDPæ€§èƒ½æµ‹è¯•.md](04-UDPæ€§èƒ½æµ‹è¯•.md)

### æ–‡ä»¶ IO

| å¹³å° | IO æ¨¡å‹ | IOPS | ååé‡ | è¯„çº§ |
|------|---------|------|--------|------|
| macOS | kqueue | 38,095 | 148.81 MB/s | â­â­â­â­â­ å“è¶Š |
| Linux | io_uring | 20,000 | 78.12 MB/s | â­â­â­â­â­ ä¼˜ç§€ |
| Linux | epoll + libaio | 13,260 | 51.80 MB/s | â­â­â­â­ è‰¯å¥½ |

> **æ³¨æ„**: ä¸åŒå¹³å°çš„æ–‡ä»¶ IO å®ç°æ–¹å¼ä¸åŒï¼Œæ€§èƒ½æ•°æ®ä¸èƒ½ç›´æ¥å¯¹æ¯”ï¼š
> - **kqueue / io_uring**: ä½¿ç”¨æ™®é€šæ–‡ä»¶æ¨¡å¼ï¼Œå¯åˆ©ç”¨æ“ä½œç³»ç»Ÿé¡µç¼“å­˜ï¼Œçƒ­æ•°æ®è®¿é—®æå¿«
> - **epoll + libaio**: å¿…é¡»ä½¿ç”¨ `O_DIRECT` æ¨¡å¼ï¼Œç»•è¿‡é¡µç¼“å­˜ï¼Œæ¯æ¬¡éƒ½æ˜¯çœŸå®ç£ç›˜ IO
>
> epoll + libaio çš„æµ‹è¯•åæ˜ çš„æ˜¯**çœŸå®ç£ç›˜æ€§èƒ½**ï¼Œé€‚åˆå¤§æ–‡ä»¶é¡ºåº IO åœºæ™¯ï¼ˆæ•°æ®åº“ã€æ—¥å¿—ç³»ç»Ÿï¼‰ã€‚
> æµ‹è¯•å‚æ•°ï¼š`-w 1 -batch 16`ï¼ˆå• workerï¼Œæ‰¹é‡ 16ï¼‰

è¯¦ç»†æ•°æ®: [08-æ–‡ä»¶IO.md](08-æ–‡ä»¶IO.md#æ€§èƒ½å‹æµ‹æ•°æ®)

### SendFile é›¶æ‹·è´ä¼ è¾“

| å¹³å° | IO æ¨¡å‹ | æ–‡ä»¶å¤§å° | sendfile åå | read+send åå | æ€§èƒ½æå‡ |
|------|---------|---------|--------------|---------------|---------|
| Linux | epoll | 100 MB | 181.49 MB/s | 101.83 MB/s | 78.2% |
| Linux | io_uring | 100 MB | 141.24 MB/s | 52.49 MB/s | 169.1% |

è¯¦ç»†æ•°æ®: [12-é›¶æ‹·è´å‘é€æ–‡ä»¶.md](12-é›¶æ‹·è´å‘é€æ–‡ä»¶.md#æ€§èƒ½åŸºå‡†)

### ComputeScheduler

| å¹³å° | ä»»åŠ¡ç±»å‹ | ååé‡ | å»¶è¿Ÿ |
|------|----------|--------|------|
| macOS (M4) | ç©ºä»»åŠ¡ | 4,000,000 tasks/s | - |
| macOS (M4) | è½»é‡è®¡ç®— | 5,000,000 tasks/s | - |
| macOS (M4) | é‡è®¡ç®— | 1,111,111 tasks/s | - |
| macOS (M4) | è°ƒåº¦å»¶è¿Ÿ | - | 7.01 Î¼s |
| Linux (i7-14700K) | ç©ºä»»åŠ¡ | 1,351,351 tasks/s | - |
| Linux (i7-14700K) | è½»é‡è®¡ç®— | 1,136,364 tasks/s | - |
| Linux (i7-14700K) | é‡è®¡ç®— | 196,078 tasks/s | - |
| Linux (i7-14700K) | è°ƒåº¦å»¶è¿Ÿ | - | 1620.96 Î¼s |

è¯¦ç»†æ•°æ®: [03-è®¡ç®—è°ƒåº¦å™¨.md](03-è®¡ç®—è°ƒåº¦å™¨.md)

### MpscChannel

| å¹³å° | åœºæ™¯ | ååé‡ | å»¶è¿Ÿ |
|------|------|--------|------|
| macOS (M4) | å•ç”Ÿäº§è€… | 27,777,778 msg/s | - |
| macOS (M4) | å¤šç”Ÿäº§è€… (4çº¿ç¨‹) | 27,777,778 msg/s | - |
| macOS (M4) | æ‰¹é‡æ¥æ”¶ | 37,037,037 msg/s | - |
| macOS (M4) | è·¨è°ƒåº¦å™¨ | 28,571,429 msg/s | - |
| Linux (i7-14700K) | å•ç”Ÿäº§è€… | 5,235,602 msg/s | - |
| Linux (i7-14700K) | å¤šç”Ÿäº§è€… (4çº¿ç¨‹) | 5,376,344 msg/s | - |
| Linux (i7-14700K) | æ‰¹é‡æ¥æ”¶ | 14,705,882 msg/s | - |
| Linux (i7-14700K) | è·¨è°ƒåº¦å™¨ | 5,128,205 msg/s | - |
| Linux (i7-14700K) | æŒç»­è´Ÿè½½ | 4,819,086 msg/s | 6159.23 Î¼s |

è¯¦ç»†æ•°æ®: [09-å¹¶å‘.md](09-å¹¶å‘.md)

### UnsafeChannel

| å¹³å° | åœºæ™¯ | ååé‡ | å»¶è¿Ÿ |
|------|------|--------|------|
| macOS (M4) | å•ç”Ÿäº§è€… | 9,009,009 msg/s | - |
| macOS (M4) | æ‰¹é‡æ¥æ”¶ | 11,764,706 msg/s | - |
| macOS (M4) | å»¶è¿Ÿæµ‹è¯• | - | 5.96 Î¼s |

> UnsafeChannel åœ¨åŒè°ƒåº¦å™¨åœºæ™¯ä¸‹æ¯” MpscChannel å¿«çº¦ 1.32x

è¯¦ç»†æ•°æ®: [09-å¹¶å‘.md](09-å¹¶å‘.md#unsafechannel-æ€§èƒ½)

---

## å…³é”®ç»“è®º

### ç½‘ç»œ IO
- ğŸ¥‡ **kqueue (macOS)**: æ€§èƒ½æœ€ä¼˜ï¼Œ31ä¸‡+ QPS
- ğŸ¥ˆ **io_uring (Linux)**: æ€§èƒ½ä¼˜ç§€ï¼Œ23ä¸‡+ QPS
- ğŸ¥‰ **epoll (Linux)**: æ€§èƒ½è‰¯å¥½ï¼Œ19ä¸‡+ QPS

### æ–‡ä»¶ IO
- ğŸš€ **kqueue (macOS)**: 38,095 IOPS
- ğŸš€ **io_uring (Linux)**: 20,000 IOPS
- ğŸš€ **epoll (Linux)**: 20,000 IOPS

### ComputeScheduler
- âš¡ **macOS (M4)**: 400ä¸‡+ tasks/sï¼Œå»¶è¿Ÿ 7.01 Î¼s
- âš¡ **Linux (i7-14700K)**: 135ä¸‡+ tasks/s

### MpscChannel
- âš¡ **macOS (M4)**: 2777ä¸‡+ msg/s
- âš¡ **Linux (i7-14700K)**: 523ä¸‡+ msg/sï¼Œæ‰¹é‡æ¥æ”¶ 1470ä¸‡+ msg/s

### UnsafeChannel
- âš¡ **macOS (M4)**: 1098ä¸‡+ msg/sï¼Œå»¶è¿Ÿ 5.96 Î¼s
- åŒè°ƒåº¦å™¨åœºæ™¯ä¸‹æ¯” MpscChannel å¿« 1.32x

### SendFile é›¶æ‹·è´ä¼ è¾“
- ğŸš€ **epoll (Linux)**: 181.49 MB/sï¼Œæ¯” read+send å¿« 78%
- ğŸš€ **io_uring (Linux)**: 141.24 MB/sï¼Œæ¯” read+send å¿« 169%

### ç”Ÿäº§å°±ç»ªåº¦
- âœ… æ‰€æœ‰å¹³å°é›¶é”™è¯¯ç‡
- âœ… ç¨³å®šæ€§ä¼˜ç§€
- âœ… æ¨èç”Ÿäº§ä½¿ç”¨

---

## å‹æµ‹å‘½ä»¤

### ç½‘ç»œ IO (TCP)
```bash
# æœåŠ¡å™¨
./build/bin/B2-TcpServer 8080

# å®¢æˆ·ç«¯
./build/bin/B3-TcpClient -h 127.0.0.1 -p 8080 -c 100 -s 256 -d 10
```

### ç½‘ç»œ IO (UDP)
```bash
./build/bin/B6-Udp
```

### æ–‡ä»¶ IO
```bash
./build/bin/B7-FileIo
```

### ComputeScheduler
```bash
./build/bin/B1-ComputeScheduler
```

### MpscChannel
```bash
./build/bin/B8-MpscChannel
```

### UnsafeChannel
```bash
./build/bin/B9-UnsafeChannel
```

---

**æŠ¥å‘Šæ›´æ–°æ—¶é—´**: 2026-01-30
