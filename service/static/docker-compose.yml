version: "3.8"

services:
  static:
    build:
      context: ../..
      dockerfile: service/static/Dockerfile
      args:
        GALAY_KERNEL_REPO: ${GALAY_KERNEL_REPO:-https://github.com/gzj-creator/galay-kernel.git}
        GALAY_KERNEL_REF: ${GALAY_KERNEL_REF:-main}
        GALAY_HTTP_REPO: ${GALAY_HTTP_REPO:-https://github.com/gzj-creator/galay-http.git}
        GALAY_HTTP_REF: ${GALAY_HTTP_REF:-main}
    container_name: galay-static-service
    env_file:
      - .env
    environment:
      - STATIC_HOST=${STATIC_HOST:-0.0.0.0}
      - STATIC_PORT=${STATIC_PORT:-8080}
      - STATIC_FRONTEND_ROOT=${STATIC_FRONTEND_ROOT:-/app/frontend}
      - API_PROXY_UPSTREAM_HOST=${API_PROXY_UPSTREAM_HOST:-127.0.0.1}
      - API_PROXY_UPSTREAM_PORT=${API_PROXY_UPSTREAM_PORT:-8081}
    ports:
      - "${STATIC_PORT:-8080}:${STATIC_PORT:-8080}"
    volumes:
      - ../../frontend:${STATIC_FRONTEND_ROOT:-/app/frontend}:ro
    restart: unless-stopped
